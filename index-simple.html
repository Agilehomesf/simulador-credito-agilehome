<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Crédito Hipotecario</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
  <div class="container my-5">
    <h1 class="text-center mb-4">Simulador de Crédito Hipotecario</h1>
    
    <div class="row">
      <div class="col-md-6 mx-auto">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Calculadora de Préstamo</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="propertyValue" class="form-label">Valor de la propiedad</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="text" class="form-control" id="propertyValue" placeholder="Ej: 200.000.000">
              </div>
            </div>
            
            <div class="mb-3">
              <label for="downPayment" class="form-label">Cuota inicial</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="text" class="form-control" id="downPayment" placeholder="Ej: 40.000.000">
              </div>
              <div class="form-text">Porcentaje: <span id="downPaymentPercentage">0</span>%</div>
            </div>
            
            <div class="alert alert-info">
              <strong>Monto a financiar:</strong> $<span id="loanAmount">0</span>
            </div>
            
            <div class="mb-3">
              <label for="loanTerm" class="form-label">Plazo (años)</label>
              <select class="form-select" id="loanTerm">
                <option value="" selected disabled>Seleccione el plazo</option>
                <option value="5">5 años</option>
                <option value="10">10 años</option>
                <option value="15">15 años</option>
                <option value="20">20 años</option>
                <option value="25">25 años</option>
                <option value="30">30 años</option>
              </select>
            </div>
            
            <div class="d-grid gap-2">
              <button id="calculateBtn" class="btn btn-primary">Calcular</button>
              <button id="resetBtn" class="btn btn-outline-secondary">Reiniciar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="results" class="mt-5 d-none">
      <h2 class="text-center mb-4">Resultados de la Simulación</h2>
      
      <div id="bankResults" class="row row-cols-1 row-cols-md-2 g-4"></div>
      
      <div class="text-center mt-4">
        <a href="https://wa.me/message/PMWO6BQHZCRSD1" class="btn btn-success btn-lg">
          <i class="bi bi-whatsapp me-2"></i>Contactar asesor por WhatsApp
        </a>
      </div>
    </div>
  </div>

  <script>
    // Datos de los bancos
    const banks = {
      "Banco de Occidente": {
        rate: 0.1290,
        rateDescription: "Desde",
        logoClass: "bi-bank"
      },
      "Banco Caja Social": {
        rate: 0.1310,
        rateDescription: "Tasa promedio",
        logoClass: "bi-house"
      },
      "Credifamilia": {
        rate: 0.1410,
        rateDescription: "Desde",
        logoClass: "bi-building"
      },
      "BBVA": {
        rate: 0.1265,
        rateDescription: "Tasa promedio",
        logoClass: "bi-bank2"
      },
      "Itaú": {
        rate: 0.1380,
        rateDescription: "Desde",
        logoClass: "bi-building-fill"
      },
      "Banco de Bogotá": {
        rate: 0.1275,
        rateDescription: "Desde",
        logoClass: "bi-bank"
      }
    };

    // Funciones
    function formatCurrency(value) {
      return new Intl.NumberFormat('es-CO').format(value);
    }
    
    function parseCurrency(value) {
      return parseInt(value.toString().replace(/\D/g, '')) || 0;
    }
    
    function calculateLoanAmount() {
      const propertyValue = parseCurrency(document.getElementById('propertyValue').value);
      const downPayment = parseCurrency(document.getElementById('downPayment').value);
      
      const loanAmount = propertyValue > downPayment ? propertyValue - downPayment : 0;
      document.getElementById('loanAmount').textContent = formatCurrency(loanAmount);
      
      const percentage = propertyValue > 0 ? (downPayment / propertyValue * 100).toFixed(1) : 0;
      document.getElementById('downPaymentPercentage').textContent = percentage;
    }
    
    function formatInputValue(input) {
      const value = parseCurrency(input.value);
      input.value = formatCurrency(value);
    }
    
    function calculateMortgage() {
      const propertyValue = parseCurrency(document.getElementById('propertyValue').value);
      const downPayment = parseCurrency(document.getElementById('downPayment').value);
      const loanTerm = parseInt(document.getElementById('loanTerm').value);
      
      // Validación básica
      if (propertyValue <= 0 || downPayment <= 0 || downPayment >= propertyValue || isNaN(loanTerm)) {
        alert('Por favor, verifique los datos ingresados');
        return;
      }
      
      const loanAmount = propertyValue - downPayment;
      
      // Calcular para cada banco
      const bankResults = [];
      const mostrarSoloBogota = loanTerm > 20 && propertyValue <= 213525000;
      
      for (const bankName in banks) {
        if (mostrarSoloBogota && bankName !== "Banco de Bogotá") {
          continue;
        }
        
        const bank = banks[bankName];
        const yearlyRate = bank.rate;
        const monthlyRate = yearlyRate / 12;
        const paymentPeriods = loanTerm * 12;
        
        // Calcular pago mensual
        const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, paymentPeriods)) 
                               / (Math.pow(1 + monthlyRate, paymentPeriods) - 1);
        
        // Calcular interés total
        const totalPayment = monthlyPayment * paymentPeriods;
        const totalInterest = totalPayment - loanAmount;
        
        bankResults.push({
          bankName,
          logoClass: bank.logoClass,
          yearlyRate,
          rateDescription: bank.rateDescription || "",
          monthlyPayment,
          totalPayment,
          totalInterest
        });
      }
      
      // Ordenar por pago mensual (menor primero)
      bankResults.sort((a, b) => a.monthlyPayment - b.monthlyPayment);
      
      // Mostrar resultados
      const resultsContainer = document.getElementById('results');
      const bankResultsContainer = document.getElementById('bankResults');
      
      bankResultsContainer.innerHTML = '';
      
      bankResults.forEach((result, index) => {
        const isBest = index === 0 ? '<span class="badge bg-success ms-2">Mejor opción</span>' : '';
        
        const card = document.createElement('div');
        card.className = 'col';
        card.innerHTML = `
          <div class="card h-100 ${index === 0 ? 'border-success' : ''}">
            <div class="card-header">
              <div class="d-flex align-items-center">
                <i class="bi ${result.logoClass} fs-4 me-2"></i>
                <h5 class="mb-0">${result.bankName} ${isBest}</h5>
              </div>
            </div>
            <div class="card-body">
              <p class="card-text">
                <strong>Tasa:</strong> ${result.rateDescription} ${(result.yearlyRate * 100).toFixed(2)}% EA
                <br>
                <strong>Cuota mensual:</strong> $${formatCurrency(Math.round(result.monthlyPayment))}
                <br>
                <strong>Total a pagar:</strong> $${formatCurrency(Math.round(result.totalPayment))}
                <br>
                <strong>Intereses totales:</strong> $${formatCurrency(Math.round(result.totalInterest))}
              </p>
            </div>
          </div>
        `;
        
        bankResultsContainer.appendChild(card);
      });
      
      resultsContainer.classList.remove('d-none');
      resultsContainer.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      const propertyValueInput = document.getElementById('propertyValue');
      const downPaymentInput = document.getElementById('downPayment');
      const calculateBtn = document.getElementById('calculateBtn');
      const resetBtn = document.getElementById('resetBtn');
      
      propertyValueInput.addEventListener('blur', function() {
        formatInputValue(this);
        calculateLoanAmount();
      });
      
      downPaymentInput.addEventListener('blur', function() {
        formatInputValue(this);
        calculateLoanAmount();
      });
      
      calculateBtn.addEventListener('click', calculateMortgage);
      
      resetBtn.addEventListener('click', function() {
        propertyValueInput.value = '';
        downPaymentInput.value = '';
        document.getElementById('loanTerm').value = '';
        document.getElementById('loanAmount').textContent = '0';
        document.getElementById('downPaymentPercentage').textContent = '0';
        document.getElementById('results').classList.add('d-none');
      });
    });
  </script>
</body>
</html>
